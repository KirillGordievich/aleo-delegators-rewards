<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
            http://www.liquibase.org/xml/ns/dbchangelog-ext
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="v1.0.0" author="kirillgordievich">
        <tagDatabase tag="v1.0.0"/>
    </changeSet>

    <!-- Sanity checks -->
    <preConditions onFail="HALT" onFailMessage="Must be running PostgreSQL >=10">
        <and>
            <dbms type="postgresql"/>
            <sqlCheck expectedResult="t">
                SELECT current_setting('server_version_num')::int > 100000;
            </sqlCheck>
        </and>
    </preConditions>

    <changeSet id="1.0.0-initial" author="kirillgordievich">
        <!-- Schema, roles -->
        <preConditions onFail="HALT" onFailMessage="Not all required roles have been created (check the README file)">
          <changeLogPropertyDefined property="aleo_rewards_owner_role" />
          <changeLogPropertyDefined property="aleo_rewards_app_role" />
          <changeLogPropertyDefined property="aleo_rewards_app_user" />
        </preConditions>

        <sqlFile path="0001_init.aleo_rewards.roles.sql" relativeToChangelogFile="true" splitStatements="false" endDelimiter="" />
        <sqlFile path="0002_init.aleo_rewards.schema.sql" relativeToChangelogFile="true" splitStatements="false" endDelimiter="" />
        <rollback>
          <sqlFile path="rollback/0002_init.aleo_rewards.schema.rollback.sql" relativeToChangelogFile="true" splitStatements="false" endDelimiter="" />
          <sqlFile path="rollback/0001_init.aleo_rewards.roles.rollback.sql" relativeToChangelogFile="true" splitStatements="false" endDelimiter="" />
        </rollback>
    </changeSet>

    <changeSet id="v1.0.0:end" author="kirillgordievich">
        <tagDatabase tag="v1.0.0:END"/>
    </changeSet>

</databaseChangeLog>